


Autohaus = {vehicles = {},
	-- Model, x, y, z, rx, ry, rz, Markerx, Markery, Markerz, Preis
	["Autos"] = {
		-- Cout and Schutz
		{567,2135.5,-1145.5,24.700000762939,0,0,90,2134.3999023438,-1147.3000488281,23.6+0.1,25000}, -- Savanna
		{534,2135.6000976563,-1140.1999511719,25.10000038147,0,0,90,2134.3999023438,-1141.8000488281,24.20000038147+0.1,22000}, -- Remington
		{466,2135.6000976563,-1135.3000488281,25.60000038147,0,0,90,2134.3999023438,-1136.9000244141,24.70000038147+0.1,7500}, -- Glendale
		{496,2118.5,-1143.3000488281,24.5,0,0,270,2119.3000488281,-1141.6999511719,23.799999237061+0.1,16000}, -- Blista Compact
		-- Truck Terminal Red County
		{478,216.900390625,-268.5,1.7000000476837,0,0,0,215.2001953125,-267.2998046875,0.59999998807907+0.1,8000}, -- Walton
		{600,211.099609375,-268.2998046875,1.3999999761581,0,0,0,209.400390625,-267.2998046875,0.59999998807907+0.1,20000}, -- Picador
		{543,200.5,-267.7001953125,1.5,0,0,308.99597167969,200,-265.900390625,0.59999998807907+0.1,15000}, -- Sadler
		{542,196.7001953125,-262.2998046875,1.3999999761581,0,0,270,197.599609375,-260.599609375,0.59999998807907+0.1,2500}, -- Clover
		{479,196.5,-256.7998046875,1.5,0,0,270,197.599609375,-255.099609375,0.59999998807907+0.1,5000}, -- Regina
		{422,204.400390625,-251.400390625,1.7000000476837,0,0,180,206.099609375,-252.099609375,0.59999998807907+0.1,4200}, -- Bobcat
		-- Wang Cars
		{549,-1958.8079833984,303.64059448242,35.330200195313,0,0,136.66711425781,-1957.6647949219,302.45819091797,34.447799682617+0.1,1250}, -- Tampa
		{412,-1962.1953125,271.92449951172,35.418701171875,0,0,331.26977539063,-1963.4533691406,273.14428710938,34.447799682617+0.1,1800}, -- Voodoo
		{400,-1947.8721923828,274.62899780273,35.604900360107,0,0,113.37158203125,-1947.4191894531,273.18255615234,34.447799682617+0.1,8400}, -- Landstalker
		{533,-1944.5876464844,265.82888793945,35.273899078369,0,0,90,-1944.9436035156,264.15521240234,34.447799682617+0.1,8500}, -- Feltzer
		{426,-1946.7241210938,256.60360717773,35.28870010376,0,0,50,-1948.0162353516,255.46139526367,34.447799682617+0.1,12500}, -- Premier
		{436,-1960.9610595703,257.44500732422,35.351898193359,0,0,325.05786132813,-1962.1734619141,258.40759277344,34.447799682617+0.1,3200}, -- Previon
		-- Ottos Cars
		{560,-1663.8073730469,1210.0765380859,7.0595998764038,0,0,281,-1664.1597900391,1211.6451416016,6.25+0.1,50000}, -- Sultan
		{522,-1653.4819335938,1215.7947998047,6.9103999137878,0,0,176.74169921875,-1652.5505371094,1215.6361083984,6.25+0.1,45000}, -- NRG-500
		{415,-1650.0616455078,1208.8942871094,13.52140045166,0,0,23.295776367188,-1651.3741455078,1207.9871826172,12.684000015259+0.1,90000}, -- Cheetah
		{411,-1671.0600585938,1206.091796875,13.471899986267,0,0,290.115234375,-1671.3721923828,1207.8259277344,12.684000015259+0.1,180000}, -- Infernus
		{429,-1649.8419189453,1209.7445068359,20.898700714111,0,0,44.261657714844,-1650.8486328125,1208.6080322266,20.166000366211+0.1,110000}, -- Banshee
		{477,-1670.3480224609,1206.0938720703,20.897899627686,0,0,287.78576660156,-1670.5177001953,1207.8812255859,20.166000366211+0.1,160000}, -- ZR-350
		-- Hafen
		{454,-2234.8278808594,2451.9191894531,0,0,0,224.72009277344,-2236.2668457031,2447.1176757813,1.485200047493+0.1,230000}, -- Tropic
		{453,-2262.4797363281,2423.2080078125,0,0,0,224.72009277344,-2258.9099121094,2424.5856933594,1.485200047493+0.1,180000}, -- Reefer
		{446,-2201.6730957031,2416.8820800781,0,0,0,45.142822265625,-2205.9130859375,2416.7736816406,1.485200047493+0.1,190000}, -- Squalo
		{493,-2228.4287109375,2389.4287109375,0,0,0,45.142822265625,-2228.3840332031,2394.1618652344,1.485200047493+0.1,170000}, -- Jetmax
		-- Flughafen
		{593,-1285.4096679688,-259.56408691406,14.698599815369,0,0,0,-1285.4223632813,-259.8362121582,13.177399635315,85000}, --  Dodo
		{460,-1304.5549316406,-271.70541381836,15.368000030518,0,0,0,-1304.5092773438,-267.34320068359,13.177399635315,135000}, -- Skimmer
		{487,-1320.5870361328,-278.65679931641,14.41339969635,0,0,0,-1320.5661621094,-273.93579101563,13.177399635315,94000}, -- Maverick
		{469,-1336.3422851563,-285.46881103516,14.248399734497,0,0,0,-1336.3615722656,-282.15539550781,13.177399635315,65000}, -- Sparrow
		{519,-1361.4670410156,-261.78579711914,15.148500442505,0,0,255.78173828125,-1352.0200195313,-264.20928955078,13.177399635315,420000}, -- Shamal
	},
	["Preise"] = {
		[567] = 25000, -- Savanna
		[534] = 22000, -- Remington
		[466] = 7500, -- Glendale
		[496] = 16000, -- Blista Compact
		
		[478] = 8000, -- Walton
		[600] = 20000, -- Picador
		[543] = 15000, -- Sadler
		[542] = 2500, -- Clover
		[479] = 5000, -- Regina
		[422] = 4200, -- Bobcat
		
		[549] = 1250, -- Tampa
		[412] = 1800, -- Voodoo
		[400] = 8400, -- Landstalker
		[533] = 85000, -- Feltzer
		[426] = 12500, -- Premier
		[436] = 3200, -- Previon
		
		[560] = 50000, -- Sultan
		[522] = 45000, -- NRG500
		[415] = 90000, -- Cheetah
		[411] = 180000, -- Infernus
		[429] = 110000, -- Banshee
		[477] = 165000, -- ZR-350
	
		[454] = 230000, -- Tropic
		[453] = 180000, -- Reefer
		[446] = 190000, -- Squalo
		[493] = 170000, -- Jetmax
		
		[593] = 85000, -- Dodo
		[460] = 135000, -- Skimmer
		[487] = 94000, -- Maverick
		[469] = 65000, -- Sparrow
		[519] = 420000, -- Shamal

		[471] = 50000, -- Quadbike
		[468] = 35000, -- Sanchez
		[586] = 25000, -- Wayfarer
		[462] = 15000, -- Faggio
	},
};

function Autohaus.loadVehicles(name)
	local result = dbPoll(dbQuery(handler,"SELECT * FROM vehicles WHERE Besitzer = ? ", name),-1);
	if(#result >= 1)then
		for _,v in pairs(result)do
			if(not(Autohaus.vehicles[v["Besitzer"]]))then Autohaus.vehicles[v["Besitzer"]] = {} end
			if(not(isElement(Autohaus.vehicles[v["Besitzer"]][v["Slot"]])))then
				Autohaus.vehicles[v["Besitzer"]][v["Slot"]] = createVehicle(v["Model"],v["Spawnx"],v["Spawny"],v["Spawnz"],0,0,v["Rotation"],v["Besitzer"]);
				setVehicleLocked(Autohaus.vehicles[v["Besitzer"]][v["Slot"]],true);
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Besitzer",v["Besitzer"]);
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Slot", v["Slot"])
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Explos", v["Explos"])
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Abgeschleppt", v["Abgeschleppt"])
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Tiefgarage", v["Tiefgarage"])
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Handbremse", v["Handbremse"])
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "VehicleID", v["ID"])
				setElementData(Autohaus.vehicles[v["Besitzer"]][v["Slot"]], "Kilometer",v["Kilometer"]);
				vehiclemanager:initVehicle(Autohaus.vehicles[v["Besitzer"]][v["Slot"]])
				Tuningsystem.loadTunings(Autohaus.vehicles[v["Besitzer"]][v["Slot"]]);
			end
		end
	end
end

for _,v in pairs(Autohaus["Autos"])do
	local vehicle = createVehicle(v[1],v[2],v[3],v[4],v[5],v[6],v[7],"Xtreme");
	setElementFrozen(vehicle,true);
	setVehicleLocked(vehicle,true);
	setVehicleDamageProof(vehicle,true);
	local marker = createMarker(v[8],v[9],v[10],"cylinder",1,0,0,255);
	
	addEventHandler("onMarkerHit",marker,function(player)
		if(not(isPedInVehicle(player)))then
			if(getElementDimension(player) == getElementDimension(source))then
				triggerClientEvent(player,"Autohaus.openWindow",player,v[1],v[11]);
			end
		end
	end)
end

function buyVehicle(player,model,preis,x,y,z,rz)
	local preis = tonumber(preis);
	if(getElementData(player,"Geld") >= preis)then
		local freeslot = 0;
		if(not(Autohaus.vehicles[getPlayerName(player)]))then Autohaus.vehicles[getPlayerName(player)] = {} end
		if(#player:getVehicles() < 10)then
			setElementData(player,"Geld",getElementData(player,"Geld")-preis);
			-- dbExec(handler,"INSERT INTO vehicles (Besitzer,Model,Spawnx,Spawny,Spawnz,Rotation,Slot, Tiefgarage, Abgeschleppt, Explos) VALUES ('"..getPlayerName(player).."','"..model.."','"..x.."','"..y.."','"..z.."','"..rz.."','"..freeslot.."', '0', '0', '0')");
			-- Autohaus.loadVehicles(player:getName());
			local vehicle = PlayerVehicleClass.new(model, x,y,z, 0, 0, rz, player:getName(), player:getId())
			vehicle:setUntouchable()
			warpPedIntoVehicle(player,vehicle);
			outputChatBox("#fa6400[INFO] #ffffffDas Fahrzeug umgehend umparken!",player,255,255,255,true);
			triggerClientEvent(player,"dxClassClose",player);
			if(model == 549 or model == 412 or model == 400 or model == 533 or model == 426 or model == 436)then
				putMoneyInBusiness(2,preis);
			elseif(model == 560 or model == 522 or model == 415 or model == 411 or model == 429 or model == 477)then
				putMoneyInBusiness(6,preis);
			elseif(model == 454 or model == 453 or model == 446 or model == 493)then
				putMoneyInBusiness(4,preis);
			end
			vehBuyLog:write(player.name, model, preis)
			if(getElementData(player,"BiketruckMarkerID") >= 1)then
				Biketruck.deleteVehicle(getElementData(player,"BiketruckMarkerID"));
			end
			setElementData(player,"BiketruckMarkerID",nil);
		else infobox(player,"Du hast keinen freien Fahrzeugslot mehr!",120,0,0)end
	else infobox(player,"Du hast nicht genug Geld dabei! ("..preis.."â‚¬)",120,0,0)end
end
addEvent("buyVehicle",true)
addEventHandler("buyVehicle",root,buyVehicle)